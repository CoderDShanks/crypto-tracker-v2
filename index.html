<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Crypto Dividend Tracker</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- TailwindCSS for utilities -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600&family=Plus+Jakarta+Sans:wght@300;500&display=swap" rel="stylesheet">

  <style type="text/tailwind">
    @layer base {
      body {
        @apply bg-[#0d0b13] min-h-screen text-gray-200 p-8 font-[PlusJakartaSans];
        background-image: radial-gradient(circle at top left, rgba(255,255,255,0.05), transparent 70%);
      }
      h1 { @apply font-[Inter] text-white text-5xl text-center drop-shadow-lg; }
      h2 { @apply text-2xl font-semibold text-white mb-4; }
      /* Glassmorphic card */
      .glass {
        @apply relative bg-white/5 backdrop-blur-lg rounded-3xl overflow-hidden transition-shadow duration-300;
      }
      .glass:hover { @apply shadow-2xl; }
      .glass::before {
        content: "";
        @apply absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent opacity-0 transition-opacity duration-700;
        transform: translateX(-150%) rotate(25deg);
      }
      .glass:hover::before {
        @apply opacity-30;
        transform: translateX(150%) rotate(25deg);
      }
      /* Buttons */
      .btn { @apply cursor-pointer select-none transition-transform duration-100; }
      .btn:active { @apply scale-95; }
      .btn-circle {
        @apply w-12 h-12 bg-white/10 text-white text-2xl font-bold rounded-full flex items-center justify-center shadow-md transition-shadow duration-200;
      }
      .btn-circle:hover { @apply bg-white/20 shadow-lg; }
      .btn-primary {
        @apply px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full font-semibold shadow-lg transition-shadow duration-200;
      }
      .btn-primary:hover { @apply shadow-2xl; }
      /* Inputs & selects */
      select, input {
        @apply w-full bg-white/20 border border-white/30 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500;
        font-size: 1rem;
      }
      select {
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg fill='white' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath d='M2 5L0 0h4z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="flex justify-center space-x-12 mb-8">
    <img src="pharaoh-logo.png" alt="Pharaoh" class="h-16 drop-shadow-2xl"/>
    <img src="velodrome-logo.png" alt="Velodrome" class="h-16 drop-shadow-2xl"/>
  </div>
  <h1>Crypto Dividend Tracker</h1>
  <p class="text-center text-gray-400 mb-12">Track your earnings across epochs with a modern glass design</p>

  <!-- Dividend Performance Chart -->
  <div class="glass p-8 mb-12">
    <h2>Dividend Performance</h2>
    <canvas id="divChart" class="w-full h-64"></canvas>
  </div>

  <!-- Controls Panel -->
  <div class="glass p-8 mb-12 space-y-6">
    <!-- Epoch Add/Remove -->
    <div class="flex justify-end space-x-4">
      <button id="deletePrevEpoch" class="btn btn-circle" title="Remove oldest epoch">–</button>
      <button id="addPrevEpoch"    class="btn btn-circle" title="Add previous epoch">+</button>
      <button id="addNextEpoch"    class="btn btn-circle" title="Add next epoch">+</button>
      <button id="deleteNextEpoch" class="btn btn-circle" title="Remove latest epoch">–</button>
    </div>
    <!-- Epoch Navigator -->
    <div class="flex justify-center items-center space-x-6">
      <button id="prevEpoch" class="btn btn-circle">&lt;</button>
      <div id="epochNumber" class="text-2xl font-medium">Epoch #1</div>
      <button id="nextEpoch" class="btn btn-circle">&gt;</button>
    </div>
    <div id="epochRange" class="text-center text-gray-400 italic">Loading…</div>

    <!-- Entry Form -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
      <div>
        <label class="block mb-2">Select Crypto</label>
        <select id="cryptoSelect">
          <option value="" disabled selected>Choose…</option>
          <option value="pharaoh">Pharaoh</option>
          <option value="velodrome">Velodrome</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <label class="block mb-2">USD Amount</label>
        <input id="divAmount" type="number" step="0.01" placeholder="e.g. 12.50"/>
      </div>
      <button id="addBtn" class="btn-primary">Add / Update</button>
    </div>
  </div>

  <!-- Epoch Table -->
  <div class="glass p-6 overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="text-gray-400">
        <tr>
          <th class="p-3 text-left">Epoch #</th>
          <th class="p-3 text-right">Pharaoh</th>
          <th class="p-3 text-right">Velodrome</th>
          <th class="p-3 text-right">Total</th>
        </tr>
      </thead>
      <tbody id="divTable"></tbody>
    </table>
  </div>

  <!-- Core JS -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const LS = 'dividends_v1';
    const load = () => JSON.parse(localStorage.getItem(LS) || '{}');
    const save = o => localStorage.setItem(LS, JSON.stringify(o));

    // compute epoch start (Thursday→Wednesday)
    const epochStart = d => {
      const day = d.getDay(), diff = day >= 4 ? day - 4 : day + 3;
      const s = new Date(d); s.setDate(d.getDate() - diff);
      return new Date(s.getFullYear(), s.getMonth(), s.getDate());
    };
    const fmtKey = d => d.toISOString().slice(0,10);
    const fmtLabel = s => {
      const e = new Date(s); e.setDate(s.getDate() + 6);
      const opts = { month:'short', day:'numeric' };
      return `${s.toLocaleDateString(undefined,opts)}–${e.toLocaleDateString(undefined,opts)}, ${e.getFullYear()}`;
    };

    // initialize epoch list from localStorage
    let epochKeys = (() => {
      const data = load();
      const keys = Object.keys(data);
      const curr = fmtKey(epochStart(new Date()));
      if (!keys.includes(curr)) keys.push(curr);
      return keys.sort();
    })();

    // add or delete epochs
    const addEpoch = dir => {
      const sorted = [...epochKeys].sort();
      const ref = dir==='prev' ? sorted[0] : sorted[sorted.length-1];
      const d = new Date(ref);
      d.setDate(d.getDate() + (dir==='prev' ? -7 : 7));
      const k = fmtKey(d);
      if (!epochKeys.includes(k)) epochKeys.push(k);
      current = epochKeys.indexOf(k);
      render();
    };
    const deleteEpoch = dir => {
      if (epochKeys.length <= 1) return;
      const sorted = [...epochKeys].sort();
      const t = dir==='prev' ? sorted[0] : sorted[sorted.length-1];
      epochKeys = epochKeys.filter(k => k !== t);
      if (current >= epochKeys.length) current = epochKeys.length - 1;
      render();
    };

    // prepare data array
    const prepare = () => {
      const data = load();
      return [...epochKeys].sort().map((k,i) => {
        const v = data[k] || { pharaoh:0, velodrome:0 };
        return {
          key: k,
          idx: i + 1,
          label: fmtLabel(new Date(k)),
          pharaoh: v.pharaoh,
          velodrome: v.velodrome,
          total: v.pharaoh + v.velodrome
        };
      });
    };

    // Chart.js setup
    const ctx = document.getElementById('divChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [
        { label:'Total',     data:[], borderColor:'#8b5cf6', backgroundColor:'rgba(139,92,246,0.2)', fill:true,  tension:0.4, pointRadius:4 },
        { label:'Pharaoh',   data:[], borderColor:'#ec4899', backgroundColor:'rgba(236,72,153,0.2)', fill:false, tension:0.4, pointRadius:3 },
        { label:'Velodrome', data:[], borderColor:'#3b82f6', backgroundColor:'rgba(59,130,246,0.2)', fill:false, tension:0.4, pointRadius:3 }
      ]]},
      options: {
        responsive: true,
        scales: {
          x: { title:{ display:true, text:'Epoch #' }, ticks:{ color:'#cbd5e1', callback:v=>'#'+v }, grid:{ color:'rgba(203,213,225,0.1)' } },
          y: { ticks:{ color:'#cbd5e1' }, grid:{ color:'rgba(203,213,225,0.1)' }, beginAtZero: true }
        },
        plugins: {
          tooltip: { callbacks: { title: ctx => prepare()[ctx[0].dataIndex].label } },
          legend: { labels:{ color:'#f8fafc' } }
        }
      }
    });

    // state & render
    let current = epochKeys.indexOf(fmtKey(epochStart(new Date())));
    function render(){
      const arr = prepare();
      chart.data.labels      = arr.map(d=>d.idx);
      chart.data.datasets[0].data = arr.map(d=>d.total.toFixed(2));
      chart.data.datasets[1].data = arr.map(d=>d.pharaoh.toFixed(2));
      chart.data.datasets[2].data = arr.map(d=>d.velodrome.toFixed(2));
      chart.update();

      // UI updates
      document.getElementById('epochNumber').textContent = `Epoch #${arr[current].idx}`;
      document.getElementById('epochRange').textContent  = arr[current].label;
      document.getElementById('prevEpoch').disabled     = (current === 0);
      document.getElementById('nextEpoch').disabled     = (current === arr.length - 1);

      // table
      document.getElementById('divTable').innerHTML = arr.map(d=>`
        <tr>
          <td class="p-3">#${d.idx}</td>
          <td class="p-3 text-right text-pink-400">${d.pharaoh.toFixed(2)}</td>
          <td class="p-3 text-right text-blue-400">${d.velodrome.toFixed(2)}</td>
          <td class="p-3 text-right font-semibold">${d.total.toFixed(2)}</td>
        </tr>
      `).join('');
    }

    // event binding
    document.getElementById('addPrevEpoch').onclick    = ()=>addEpoch('prev');
    document.getElementById('deletePrevEpoch').onclick = ()=>deleteEpoch('prev');
    document.getElementById('addNextEpoch').onclick    = ()=>addEpoch('next');
    document.getElementById('deleteNextEpoch').onclick = ()=>deleteEpoch('next');
    document.getElementById('prevEpoch').onclick       = ()=>{ if(current>0) current--; render(); };
    document.getElementById('nextEpoch').onclick       = ()=>{ if(current<epochKeys.length-1) current++; render(); };
    document.getElementById('addBtn').onclick          = ()=>{
      const c = document.getElementById('cryptoSelect').value;
      const a = parseFloat(document.getElementById('divAmount').value);
      if(!c||isNaN(a)) return alert('Select crypto & enter a valid amount.');
      const k = epochKeys[current], data = load();
      data[k] ??= { pharaoh:0, velodrome:0 };
      data[k][c] += a;
      save(data);
      document.getElementById('divAmount').value = '';
      render();
    };

    // initial render
    render();
  });
  </script>
</body>
</html>
