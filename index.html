<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Epoch Dividend Tracker</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Modern Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #111217, #1a1a23);
      color: #e5e7eb;
      min-height: 100vh;
    }
    h1 {
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      color: #f9fafb;
    }
    .glass {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .btn-primary {
      @apply px-4 py-2 rounded font-semibold text-white bg-gradient-to-r from-indigo-500 to-purple-500 shadow-lg;
    }
    .btn-primary:hover {
      @apply from-indigo-600 to-purple-600;
    }
    select, input {
      @apply bg-transparent border border-gray-600 text-gray-200 rounded p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500;
    }
  </style>
</head>
<body>
  <div class="max-w-4xl mx-auto p-6 space-y-8">

    <!-- HEADER -->
    <h1 class="text-3xl text-center">ðŸ•’ Epoch Dividend Tracker</h1>

    <!-- CHART CARD -->
    <div class="glass rounded-2xl p-6 shadow-2xl">
      <canvas id="divChart"></canvas>
    </div>

    <!-- ENTRY FORM -->
    <div class="glass rounded-2xl p-6 shadow-2xl grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <div>
        <label class="block mb-1 text-gray-300">Epoch</label>
        <select id="epochSelect" class="w-full"></select>
      </div>
      <div>
        <label class="block mb-1 text-gray-300">Crypto</label>
        <select id="cryptoSelect">
          <option value="" disabled selected>Chooseâ€¦</option>
          <option value="pharaoh">Pharaoh</option>
          <option value="velodrome">Velodrome</option>
        </select>
      </div>
      <div>
        <label class="block mb-1 text-gray-300">Amount (USD)</label>
        <input type="number" id="divAmount" step="0.01" placeholder="e.g. 15.50" />
      </div>
      <button id="addBtn" class="btn-primary">Add / Update</button>
    </div>

    <!-- TABLE CARD -->
    <div class="glass rounded-2xl p-4 shadow-2xl overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="text-gray-400">
            <th class="p-2 text-left">Epoch</th>
            <th class="p-2 text-right">Pharaoh</th>
            <th class="p-2 text-right">Velodrome</th>
            <th class="p-2 text-right">Total</th>
          </tr>
        </thead>
        <tbody id="divTable"></tbody>
      </table>
    </div>
  </div>

  <script>
  // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const LS = 'dividends_v6';
  const load = () => JSON.parse(localStorage.getItem(LS) || '{}');
  const save = obj => localStorage.setItem(LS, JSON.stringify(obj));

  // compute epoch start (Thuâ†’Wed)
  function epochStart(d) {
    const day = d.getDay(), diff = day >= 4 ? day - 4 : day + 3;
    const s = new Date(d); s.setDate(d.getDate() - diff);
    return new Date(s.getFullYear(), s.getMonth(), s.getDate());
  }
  // format YYYY-MM-DD
  const keyFmt = d => d.toISOString().slice(0,10);
  // format human label e.g. "Jun 19â€“Jun 25, 2025"
  function labelFmt(start) {
    const end = new Date(start);
    end.setDate(start.getDate() + 6);
    const opts = { month:'short', day:'numeric' };
    const s = start.toLocaleDateString(undefined, opts);
    const e = end.toLocaleDateString(undefined, opts);
    const y = end.getFullYear();
    return `${s}â€“${e}, ${y}`;
  }

  // generate a list of epoch-start keys (past 52 to next 4)
  function generateEpochKeys() {
    const keys = [];
    const today = new Date();
    const base = epochStart(today);
    for(let i = 52; i >= 0; i--) {
      const d = new Date(base);
      d.setDate(base.getDate() - i*7);
      keys.push(keyFmt(d));
    }
    for(let i = 1; i <= 4; i++) {
      const d = new Date(base);
      d.setDate(base.getDate() + i*7);
      keys.push(keyFmt(d));
    }
    return keys;
  }

  // prepare data array for chart & table
  function prepare(dataObj) {
    const keys = generateEpochKeys();
    return keys.map(k => {
      const o = dataObj[k] || { pharaoh:0, velodrome:0 };
      return { key:k, label: labelFmt(new Date(k)), pharaoh: o.pharaoh, velodrome: o.velodrome, total: o.pharaoh+o.velodrome };
    });
  }

  // â”€â”€â”€ Chart.js Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ctx = document.getElementById('divChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: { labels:[], datasets:[
      { label:'Total',     data:[], borderColor:'#8b5cf6', backgroundColor:'rgba(139,92,246,0.2)', fill:true, tension:0.4, pointRadius:4 },
      { label:'Pharaoh',   data:[], borderColor:'#ec4899', backgroundColor:'rgba(236,72,153,0.2)', fill:false, tension:0.4, pointRadius:3 },
      { label:'Velodrome', data:[], borderColor:'#3b82f6', backgroundColor:'rgba(59,130,246,0.2)', fill:false, tension:0.4, pointRadius:3 },
    ]},
    options: {
      responsive:true,
      scales:{
        x:{ ticks:{ color:'#cbd5e1' }, grid:{ color:'rgba(203,213,225,0.1)' } },
        y:{ ticks:{ color:'#cbd5e1' }, grid:{ color:'rgba(203,213,225,0.1)' }, beginAtZero:true }
      },
      plugins:{ legend:{ labels:{ color:'#f8fafc' } } }
    }
  });

  // â”€â”€â”€ Render UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderAll() {
    const dataObj = load();
    const arr = prepare(dataObj);

    // Chart
    chart.data.labels   = arr.map(d=>d.label);
    chart.data.datasets[0].data = arr.map(d=>d.total.toFixed(2));
    chart.data.datasets[1].data = arr.map(d=>d.pharaoh.toFixed(2));
    chart.data.datasets[2].data = arr.map(d=>d.velodrome.toFixed(2));
    chart.update();

    // Epoch dropdown
    const sel = document.getElementById('epochSelect');
    sel.innerHTML = arr.map(d =>
      `<option value="${d.key}">${d.label}</option>`
    ).join('');
    sel.value = keyFmt(epochStart(new Date()));

    // Table
    document.getElementById('divTable').innerHTML = arr.map(d => `
      <tr>
        <td class="p-2">${d.label}</td>
        <td class="p-2 text-right text-pink-400">${d.pharaoh.toFixed(2)}</td>
        <td class="p-2 text-right text-blue-400">${d.velodrome.toFixed(2)}</td>
        <td class="p-2 text-right font-semibold">${d.total.toFixed(2)}</td>
      </tr>
    `).join('');
  }

  // â”€â”€â”€ Add / Update Handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('addBtn').onclick = () => {
    const epoch = document.getElementById('epochSelect').value;
    const crypto = document.getElementById('cryptoSelect').value;
    const amt = parseFloat(document.getElementById('divAmount').value);
    if (!epoch || !crypto || isNaN(amt)) {
      return alert('Select Epoch, Crypto & enter a valid amount.');
    }
    const dataObj = load();
    dataObj[epoch] ??= { pharaoh:0, velodrome:0 };
    dataObj[epoch][crypto] += amt;
    save(dataObj);
    renderAll();
    document.getElementById('divAmount').value = '';
  };

  // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  renderAll();
  </script>
</body>
</html>
