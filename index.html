<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Crypto Dividend Tracker - Aurora Edition</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --background: #0D1117;
      --surface: #161B22;
      --pharaoh-color: #F87171; /* Softer Red */
      --velodrome-color: #60A5FA; /* Softer Blue */
      --text-primary: #E6EDF3;
      --text-secondary: #7D8590;
      --border: #30363D;
      --glow-color: rgba(139, 193, 255, 0.4);
    }
    /* ─── Base & Aurora Background ─────────────────────────────────── */
    html, body {
      height: 100%; margin: 0; padding: 0; overflow: hidden;
      background-color: var(--background);
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
    }
    #aurora-background, .star-layer {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      overflow: hidden; pointer-events: none;
    }
    .star-layer {
      background-image:
        radial-gradient(1px 1px at 25px 5px, white, transparent),
        radial-gradient(1px 1px at 50px 25px, white, transparent),
        radial-gradient(1.5px 1.5px at 125px 80px, white, transparent),
        radial-gradient(1px 1px at 220px 180px, white, transparent);
      background-size: 250px 250px;
      animation: pan-stars 120s linear infinite;
    }
    .star-layer.layer-2 { animation-duration: 90s; opacity: 0.6; }
    .star-layer.layer-3 { animation-duration: 60s; opacity: 0.3; }
    @keyframes pan-stars { from { transform: translateX(0); } to { transform: translateX(-250px); } }
    
    #cursor-glow {
        position: fixed;
        width: 1000px; height: 1000px;
        background: radial-gradient(circle, rgba(60, 130, 223, 0.1), transparent 40%);
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        transition: opacity 0.3s;
        z-index: -1;
    }
    /* ─── Main Layout & Panel Styling ──────────────────────────────── */
    .container {
      position: relative; z-index: 1;
      display: flex; flex-direction: column; height: 100%;
      padding: 1.5rem; box-sizing: border-box; overflow-y: auto;
      -ms-overflow-style: none; scrollbar-width: none;
    }
    .container::-webkit-scrollbar { display: none; }
    .panel {
      background: rgba(22, 27, 34, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px; padding: 1.5rem; margin-bottom: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      animation: panel-fade-in 0.6s ease-out forwards, panel-glow 3s infinite alternate;
      opacity: 0;
    }
    @keyframes panel-fade-in { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes panel-glow {
        from { box-shadow: 0 0 12px rgba(0,0,0,0.5), 0 0 2px var(--glow-color); }
        to   { box-shadow: 0 0 24px rgba(0,0,0,0.5), 0 0 8px var(--glow-color); }
    }
    #chartPanel { animation-delay: 0.1s; }
    #controls { animation-delay: 0.2s; }
    .panel:last-child { animation-delay: 0.3s; }

    /* ─── Typography & Text Effects ────────────────────────────────── */
    h1 {
      font-size: 2.25rem; font-weight: 700; text-align: center;
      margin-bottom: .25rem; letter-spacing: -1px;
      text-shadow: 0 0 10px var(--glow-color);
    }
    p.subtitle {
      text-align: center; color: var(--text-secondary);
      margin-bottom: 2rem; font-weight: 400;
    }
    h2 { font-weight: 600; font-size: 1.25rem; margin: 0 0 1rem 0; }
    .epoch-text { transition: opacity 0.15s ease-in-out, transform 0.15s ease-in-out; }
    .fade-out { opacity: 0; transform: translateY(-10px); }
    .fade-in { opacity: 1; transform: translateY(0); }

    /* ─── Chart & Controls ─────────────────────────────────────────── */
    #chartContainer { height: 320px; }
    canvas { width:100% !important; height:100% !important; cursor: crosshair; }
    .row { display:flex; align-items:center; justify-content:center; gap: 0.75rem; }
    .row.space { justify-content: flex-end; }
    .grid { display:flex; flex-wrap:wrap; gap:.75rem; }
    .grid > * { flex:1; min-width:120px; }
    .btn, .circle-btn { position: relative; overflow: hidden; }
    .btn {
      background-color: var(--text-primary); color: var(--background);
      font-weight: 600; border: none; border-radius:10px;
      padding:.75rem 1.5rem; font-size:1rem; cursor:pointer;
      transition: all .2s ease;
    }
    .btn:hover { background-color: #CCCCCC; transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .circle-btn {
      width:44px; height:44px; background: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary); border:1px solid var(--border);
      border-radius:50%; font-size:1.2rem; cursor:pointer;
      display:grid; place-items:center; transition: all .2s ease;
    }
    .circle-btn:hover {
      transform: translateY(-2px); color: var(--text-primary);
      border-color: var(--glow-color);
      box-shadow: 0 0 15px var(--glow-color);
    }
    .circle-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; border-color: var(--border); }
    .ripple {
      position: absolute; border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      transform: scale(0);
      animation: ripple-effect 0.6s linear;
    }
    @keyframes ripple-effect { to { transform: scale(4); opacity: 0; } }

    /* ─── Inputs & Table ───────────────────────────────────────────── */
    select, input[type=number] {
      width:100%; padding:.75rem; background: var(--background);
      border:1px solid var(--border); border-radius:10px; color:var(--text-primary);
      font-size:1rem; transition: all 0.2s;
    }
    select:focus, input:focus {
        outline: none; border-color: var(--glow-color);
        box-shadow: 0 0 15px var(--glow-color);
    }
    select {
      appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%238E8E93' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 1rem center;
    }
    table { width:100%; border-collapse:collapse; margin-top:.75rem; }
    th, td { padding:.8rem 1rem; border-bottom:1px solid var(--border); }
    th:not(:first-child), td:not(:first-child) { text-align: right; }
    th:first-child, td:first-child { text-align: left; }
    th { color:var(--text-secondary); font-weight: 500; font-size: 0.9rem;}
    tbody tr { transition: background-color 0.2s ease, transform 0.2s ease; }
    tbody tr:hover {
        background-color: rgba(60, 130, 223, 0.1);
        transform: scale(1.02);
    }
  </style>
</head>
<body>
  <div id="aurora-background">
      <div id="cursor-glow"></div>
      <div class="star-layer layer-1"></div>
      <div class="star-layer layer-2"></div>
      <div class="star-layer layer-3"></div>
  </div>
  <div class="container">
    <h1>Crypto Dividend Tracker</h1>
    <p class="subtitle">An aurora-themed dashboard for tracking your earnings.</p>
    <div id="chartPanel" class="panel">
      <h2>Dividend Performance</h2>
      <div id="chartContainer"><canvas id="chart"></canvas></div>
    </div>
    <div id="controls" class="panel">
      <div class="row space">
        <button class="circle-btn" id="delPrev" title="Delete Earliest Epoch">−</button>
        <button class="circle-btn" id="addPrev" title="Add Earlier Epoch">＋</button>
        <button class="circle-btn" id="addNext" title="Add Later Epoch">＋</button>
        <button class="circle-btn" id="delNext" title="Delete Latest Epoch">−</button>
      </div>
      <div class="row" style="margin:1rem 0;">
        <button class="circle-btn" id="prev">&lt;</button>
        <span id="epochNum" class="epoch-text" style="font-size:1.25rem; font-weight:600; flex-grow:1; text-align:center;">Epoch #1</span>
        <button class="circle-btn" id="next">&gt;</button>
      </div>
      <div id="epochRange" class="epoch-text" style="text-align:center;color:var(--text-secondary);margin-bottom:1.5rem;">Loading…</div>
      <div class="grid">
        <select id="crypto">
          <option value="">Choose Crypto</option>
          <option value="pharaoh">Pharaoh</option>
          <option value="velodrome">Velodrome</option>
        </select>
        <input id="amount" type="number" placeholder="Amount (USD)"/>
        <button id="addBtn" class="btn">Add / Update</button>
      </div>
    </div>
    <div class="panel">
      <table>
        <thead>
          <tr><th>Epoch #</th><th>Pharaoh</th><th>Velodrome</th><th>Total</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
  window.onload = function() {
    const STORAGE = 'divTrackerLux';
    const loadData = () => JSON.parse(localStorage.getItem(STORAGE)||'{}');
    const saveData = d => localStorage.setItem(STORAGE, JSON.stringify(d));

    function epochStart(d) {
      const day = d.getDay(), diff = day>=4 ? day-4 : day+3;
      const s = new Date(d); s.setDate(d.getDate()-diff);
      return new Date(s.getFullYear(),s.getMonth(),s.getDate());
    }
    const keyFmt = d => d.toISOString().slice(0,10);
    function labelFmt(s) {
      const e = new Date(s); e.setDate(s.getDate()+6);
      const o={month:'short',day:'numeric'};
      return `${s.toLocaleDateString(undefined,o)} – ${e.toLocaleDateString(undefined,o)}, ${e.getFullYear()}`;
    }

    let epochs = (() => {
      const d = loadData(), ks = Object.keys(d);
      const cur = keyFmt(epochStart(new Date()));
      if (!ks.includes(cur)) ks.push(cur);
      return ks.sort();
    })();
    let current = epochs.indexOf(keyFmt(epochStart(new Date())));
    if (current === -1 && epochs.length > 0) {
        current = epochs.length -1;
    } else if (current === -1) {
        current = 0;
    }

    let hoveredElement = null;
    let mousePosition = null;

    const glassReflectionPlugin = {
        id: 'glassReflection',
        afterEvent: (chart, args) => {
            const event = args.event;
            if (event.type === 'mousemove') {
                const elements = chart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
                let needsRender = false;
                if (elements.length > 0) {
                    const el = elements[0];
                    if (hoveredElement?._index !== el._index || hoveredElement?._datasetIndex !== el._datasetIndex) {
                        hoveredElement = el;
                        needsRender = true;
                    }
                    mousePosition = { x: event.x, y: event.y };
                } else if (hoveredElement) {
                    hoveredElement = null;
                    mousePosition = null;
                    needsRender = true;
                }
                if (needsRender) chart.draw();
            } else if (event.type === 'mouseout' && hoveredElement) {
                hoveredElement = null;
                mousePosition = null;
                chart.draw();
            }
        },
        afterDraw: (chart) => {
            if (hoveredElement && mousePosition) {
                const ctx = chart.ctx;
                const { x, y, base, width } = hoveredElement;
                const height = base - y;
                ctx.save();
                ctx.beginPath();
                ctx.rect(x - width / 2, y, width, height);
                ctx.clip();
                const gradient = ctx.createRadialGradient(
                    mousePosition.x, mousePosition.y, 0,
                    mousePosition.x, mousePosition.y, width * 0.8
                );
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.5)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(x - width / 2, y, width, height);
                ctx.restore();
            }
        }
    };

    const ctx = document.getElementById('chart').getContext('2d');
    const pharaohGradient = ctx.createLinearGradient(0, 0, 0, 320);
    pharaohGradient.addColorStop(0, 'rgba(248, 113, 113, 1)');
    pharaohGradient.addColorStop(0.1, 'rgba(239, 68, 68, 0.9)');
    pharaohGradient.addColorStop(0.5, 'rgba(220, 38, 38, 0.9)');
    pharaohGradient.addColorStop(1, 'rgba(239, 68, 68, 0.9)');
    const velodromeGradient = ctx.createLinearGradient(0, 0, 0, 320);
    velodromeGradient.addColorStop(0, 'rgba(96, 165, 250, 1)');
    velodromeGradient.addColorStop(0.1, 'rgba(59, 130, 246, 0.9)');
    velodromeGradient.addColorStop(0.5, 'rgba(37, 99, 235, 0.9)');
    velodromeGradient.addColorStop(1, 'rgba(59, 130, 246, 0.9)');

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Pharaoh', data: [], backgroundColor: pharaohGradient,
            borderColor: 'rgba(255,255,255,0.4)', borderWidth: 1.5, borderRadius: 5,
          },
          {
            label: 'Velodrome', data: [], backgroundColor: velodromeGradient,
            borderColor: 'rgba(255,255,255,0.4)', borderWidth: 1.5, borderRadius: 5,
          }
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: false, layout: { padding: 8 },
        scales: {
          x: { stacked: true, ticks: { color: 'var(--text-primary)', font: { family: "'Inter', sans-serif" } }, grid: { display: false } },
          y: { stacked: true, beginAtZero: true, ticks: { color: 'var(--text-primary)', font: { family: "'Inter', sans-serif" }, callback: (v) => '$' + v }, grid: { color: 'rgba(255, 255, 255, 0.05)' } }
        },
        plugins: {
          tooltip: {
            backgroundColor: 'rgba(10,10,10,0.8)', titleFont: { family: "'Inter', sans-serif", weight: '600', size: 14 },
            bodyFont: { family: "'Inter', sans-serif" }, titleColor: '#FFFFFF', bodyColor: '#CCCCCC',
            padding: 12, cornerRadius: 8, callbacks: { title: ctx => prepare()[ctx[0].dataIndex].label },
          },
          legend: { display: true, labels: { color: 'var(--text-primary)', font: { family: "'Inter', sans-serif" } } }
        }
      },
      plugins: [glassReflectionPlugin]
    });

    function prepare() {
      const d = loadData();
      return epochs.map((k,i) => {
        const v = d[k] || { pharaoh:0, velodrome:0 };
        return {
            key: k, idx: i+1, label: labelFmt(new Date(k)),
            pharaoh: v.pharaoh || 0, velodrome: v.velodrome || 0,
            total: (v.pharaoh || 0) + (v.velodrome || 0)
        };
      });
    }

    const epochNumEl = document.getElementById('epochNum');
    const epochRangeEl = document.getElementById('epochRange');

    function render() {
      const arr = prepare();
      if (!arr.length) return;
      chart.data.labels = arr.map(x => `Epoch ${x.idx}`);
      chart.data.datasets[0].data = arr.map(x => x.pharaoh);
      chart.data.datasets[1].data = arr.map(x => x.velodrome);
      chart.update();
      if (current >= arr.length) current = arr.length - 1;
      
      // Epoch Text cross-fade animation
      const elementsToFade = [epochNumEl, epochRangeEl];
      elementsToFade.forEach(el => el.classList.add('fade-out'));
      setTimeout(() => {
          epochNumEl.textContent = `Epoch #${arr[current].idx}`;
          epochRangeEl.textContent = arr[current].label;
          elementsToFade.forEach(el => {
              el.classList.remove('fade-out');
              el.classList.add('fade-in');
          });
      }, 150);

      document.getElementById('prev').disabled = (current === 0);
      document.getElementById('next').disabled = (current === arr.length - 1);
      const formatCurrency = (num) => `$${num.toFixed(2)}`;
      document.getElementById('tableBody').innerHTML = arr.map(x => `
        <tr>
          <td>${x.idx}</td>
          <td style="color:var(--pharaoh-color);">${formatCurrency(x.pharaoh)}</td>
          <td style="color:var(--velodrome-color);">${formatCurrency(x.velodrome)}</td>
          <td style="font-weight:600; color: var(--text-primary);">${formatCurrency(x.total)}</td>
        </tr>
      `).reverse().join('');
    }

    function createRipple(event) {
        const button = event.currentTarget;
        const circle = document.createElement("span");
        const diameter = Math.max(button.clientWidth, button.clientHeight);
        const radius = diameter / 2;
        circle.style.width = circle.style.height = `${diameter}px`;
        circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
        circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
        circle.classList.add("ripple");
        const ripple = button.getElementsByClassName("ripple")[0];
        if (ripple) { ripple.remove(); }
        button.appendChild(circle);
    }
    document.querySelectorAll(".btn, .circle-btn").forEach(button => button.addEventListener("click", createRipple));
    
    document.getElementById('cursor-glow').style.opacity = '0';
    document.addEventListener('mousemove', e => {
        const glow = document.getElementById('cursor-glow');
        glow.style.opacity = '1';
        glow.style.left = `${e.clientX}px`;
        glow.style.top = `${e.clientY}px`;
    });
    document.addEventListener('mouseleave', () => {
        document.getElementById('cursor-glow').style.opacity = '0';
    });

    document.getElementById('addPrev').onclick = () => { let d=new Date(epochs[0]); d.setDate(d.getDate()-7); epochs.unshift(keyFmt(d)); current=0; render(); };
    document.getElementById('delPrev').onclick = () => { if(epochs.length>1){ epochs.shift(); if(current>0) current--; render(); } };
    document.getElementById('addNext').onclick = () => { let d=new Date(epochs[epochs.length-1]); d.setDate(d.getDate()+7); epochs.push(keyFmt(d)); current=epochs.length-1; render(); };
    document.getElementById('delNext').onclick = () => { if(epochs.length>1){ epochs.pop(); if(current>=epochs.length) current=epochs.length-1; render(); } };
    document.getElementById('prev').onclick    = () => { if(current>0) { current--; render(); } };
    document.getElementById('next').onclick    = () => { if(current<epochs.length-1) { current++; render(); } };
    document.getElementById('addBtn').onclick  = () => {
      const c = document.getElementById('crypto').value;
      const a = parseFloat(document.getElementById('amount').value);
      if(!c||isNaN(a)) return alert('Please select a crypto and enter a valid amount.');
      let d = loadData(), k=epochs[current];
      d[k] = d[k]||{ pharaoh:0, velodrome:0 };
      d[k][c] = a;
      saveData(d); document.getElementById('amount').value=''; render();
    };

    render();
  };
  </script>
</body>
</html>